var Creditly=function(){var e,r,t,n=function(e,r){var t=$.trim($(r).val());return t+=String.fromCharCode(e.which),a(t)},a=function(e){return e.replace(/[^\d]/g,"")},i=function(e,r,t){return e.preventDefault(),!(function(e,r,t){return n(e,t).length>r}(e,r,t)||e.shiftKey||!function(e){return/^\d+$/.test(String.fromCharCode(e.which))}(e))},u=function(e){return e.match("^(34|37)")},s=function(e,r,t){return!function(e){return-1!==$.inArray(e.which,[46,8,9,0,27,13,190])||65==e.which&&!0===e.ctrlKey||67==e.which&&!0===e.ctrlKey||86==e.which&&!0===e.ctrlKey||e.which>=35&&e.which<=39}(e)&&i(e,r,t)},c={createCvvInput:function(t,a){e=t,r=a,$(e).keypress(function(t){$(e).removeClass("has-error");var a=n(t,r),i=n(t,e),c=function(e){return e?4:3}(u(a));s(t,c,e)&&$(e).val(i)})}},o=function(){var e,r=[4,10,15],t=[4,8,12,16],a=function(e,r){for(var t=[],n=0,a=0;a<r.length;a++){if(!(e.length>r[a])){a<r.length?t.push(e.slice(n,r[a])):t.push(e.slice(n));break}t.push(e.slice(n,r[a])),n=r[a]}return t.length>0?t.join(" "):e};return{createNumberInput:function(i){e=i,$(e).keypress(function(i){$(e).removeClass("has-error");var c,o=n(i,e),l=u(o),d=function(e){return e?15:16}(l);s(i,d,e)&&(c=a(o,l?r:t),$(e).val(c),$(e).trigger("changed_input"))})}}}(),l=function(){var e,r,t,n=(e=/(\d\d)\s*\/\s*(\d\d)/,r=function(e){return 15==e.length},t=function(e){if(0===e.length)return!1;if(/[^0-9-\s]+/.test(e))return!1;for(var r=0,t=0,n=!1,a=e.length-1;a>=0;a--){var i=e.charAt(a);t=parseInt(i,10);n&&(t*=2)>9&&(t-=9),r+=t,n=!n}return r%10==0},{creditCard:function(e,n){var a=$(n.creditCardNumberSelector).val(),i=$.trim(a).replace(/\D/g,""),u=$(n.cvvSelector).val(),s=$.trim(u).replace(/\D/g,""),c=[],o=!0,l=[];return t(i)||(c.push(n.message.number),l.push(n.creditCardNumberSelector),o=!1),function(e,r){return!!(e&&4==r.length||!e&&3==r.length)}(r(i),s)||(c.push(n.message.security_code),l.push(n.cvvSelector),o=!1),result={is_valid:o,output_value:[i,s],selectors:l,messages:c},result},creditCardExpiration:function(r,t){var n=$.trim($(r).val()),a=e.exec(n),i=!1,u=["",""];if(a&&3===a.length){var s=parseInt(a[1],10),c="20"+a[2];s>=0&&s<=12&&(i=!0,u=[s,c])}return{is_valid:i,messages:[t.message],output_value:u}}}),a=function(e,r,t,a){if(r.hasOwnProperty(e)){var i=r[e],u=i.type,s=(i.name,n[u](e,i.data));if(!s.is_valid)return t.addError(e,s),!0;if(i.output_name instanceof Array)for(var c=0;c<i.output_name.length;c++)a.addOutput(i.output_name[c],s.output_value[c]);else a.addOutput(i.output_name,s.output_value)}};return{validate:function(e){var r,t,n,i=(r=[],t=[],{addError:function(e,n){n.hasOwnProperty("selectors")?t=t.concat(n.selectors):t.push(e),r.concat(n.messages)},triggerErrorMessage:function(){for(var e={selectors:t,messages:r},n=0;n<t.length;n++)$(t[n]).addClass("has-error");$("body").trigger("creditly_client_validation_error",e)}}),u=(n={},{addOutput:function(e,r){for(var t=e.split("."),a=n,i=0;i<t.length;i++)a.hasOwnProperty(t[i])||(a[t[i]]={}),i===t.length-1?a[t[i]]=r:a=a[t[i]]},getOutput:function(){return n}}),s=!1;for(var c in e)a(c,e,i,u)&&(s=!0);return s?(i.triggerErrorMessage(),!1):u.getOutput()}}}(),d=function(){var e;return{createExpirationInput:function(r){e=r,$(e).keypress(function(r){if($(e).removeClass("has-error"),s(r,4,e)){var t=n(r,e);if(t.length>=2){var a=t.slice(0,2)+" / "+t.slice(2);$(e).val(a)}else $(e).val(t)}})},parseExpirationInput:function(e){var r=a($(e).val()),t=r.slice(0,2);return{year:"20"+r.slice(2),month:t}}}}(),p={changeCardType:function(e,r){$(e).on("changed_input keypress keydown keyup",function(t){var n,i=$(e).val(),u=(n=a(i),/^(34|37)/.test(n)?"American Express":/^4/.test(n)?"Visa":/^5[0-5]/.test(n)?"MasterCard":/^(6011|622|64[4-9]|65)/.test(n)?"Discover":"");$(r).text(u)})}},v=function(e,r,n,a){var i=a||{};i.security_code_message=i.security_code_message||"Your security code is invalid",i.number_message=i.number_message||"Your credit card number is invalid",i.expiration_message=i.expiration_message||"Your credit card expiration is invalid",(t={})[r]={type:"creditCard",data:{cvvSelector:n,creditCardNumberSelector:r,message:{security_code:i.security_code_message,number:i.number_message}},output_name:["number","security_code"]},t[e]={type:"creditCardExpiration",data:{message:i.expiration_message},output_name:["expiration_month","expiration_year"]}};return{initialize:function(e,r,t,n,a){return v(e,r,t,a),d.createExpirationInput(e),o.createNumberInput(r),c.createCvvInput(t,r),p.changeCardType(r,n),this},validate:function(){return l.validate(t)}}}();